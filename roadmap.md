## ç”Ÿäº§å¯ç”¨è·¯çº¿å›¾ï¼ˆç¤¾åŒºç‰ˆï¼šå•æœº/è½»é‡å¤åˆ¶ï¼Œå…¼å®¹ Redis å®¢æˆ·ç«¯ï¼‰

> ç›®æ ‡ï¼šåœ¨ä¸åŒ…å« Sentinel/Cluster ç­‰å¤šæœåŠ¡å™¨é«˜å¯ç”¨ç‰¹æ€§çš„å‰æä¸‹ï¼Œæä¾›å¯æ›¿ä»£ Redis çš„ç”Ÿäº§å¯ç”¨å•å®ä¾‹ï¼ˆå¯é€‰è½»é‡å¤åˆ¶ï¼‰ï¼Œå…¼å®¹ç°æœ‰ Redis å®¢æˆ·ç«¯ä¸åè®®ä¹ æƒ¯ã€‚

### ä¸€ã€åè®®ä¸å‘½ä»¤è¦†ç›– âœ… Phase A+B å‘½ä»¤è¡¥å…¨å®Œæˆ

- âœ… **æ ¸å¿ƒæ•°æ®ç»“æ„**ï¼šStrings/Lists/Sets/Hashes/Sorted Sets å·²å®Œæ•´å®ç°
  - Sorted Sets: ZADD/ZRANGE/ZREVRANGE/ZREM/ZCARD/ZINCRBY/ZSCORE/ZSCAN/ZCOUNT/ZRANK/ZREVRANK/ZPOPMIN/ZPOPMAX/ZINTER/ZUNION/ZDIFF/ZLEXCOUNT åŠ STORE å˜ä½“
  - Lists: LPUSH/RPUSH/LPOP/RPOP/LRANGE/LLEN/LINDEX/LREM/LTRIM/LSET/LINSERT/RPOPLPUSH/LPOS
  - Hashes: HSET/HGET/HDEL/HEXISTS/HGETALL/HKEYS/HVALS/HLEN/HMGET/HMSET/HSETNX/HSTRLEN/HINCRBY/HINCRBYFLOAT/HSCAN
- âœ… **äº‹åŠ¡ä¸è„šæœ¬**ï¼šMULTI/EXEC/DISCARD/WATCH/UNWATCH å·²å®ç°
  - Lua è„šæœ¬ï¼šEVAL/EVALSHA/SCRIPT LOAD/EXISTS/FLUSH
  - redis.call/pcall å›è°ƒæ”¯æŒ 46 ä¸ªå‘½ä»¤ï¼ˆäºŒè¿›åˆ¶å®‰å…¨ï¼‰
- âœ… **Pub/Sub**ï¼šå·²æ”¯æŒ channel/pattern/shard å­é›†ä¸ PUBSUB æŸ¥è¯¢
- âœ… **æ‰«æå‘½ä»¤**ï¼šSCAN/SSCAN/HSCAN/ZSCAN å·²å®ç°
- âœ… **è¿ç»´å‘½ä»¤**ï¼šCONFIG GET/SETã€CLIENT LIST/ID/SETNAME/GETNAMEã€SLOWLOG åŸºç¡€
- âœ… **Generic å‘½ä»¤**ï¼šCOPY/UNLINK/TOUCH/OBJECT ENCODING
- âœ… **Expire å‘½ä»¤**ï¼šEXPIRE/PEXPIRE/EXPIREAT/PEXPIREAT/TTL/PTTL/EXPIRETIME/PEXPIRETIME/PERSIST
- âœ… **HyperLogLog**ï¼šPFADD/PFCOUNT/PFMERGE
- ğŸ”„ **å¾…è¡¥é½**ï¼šStreamsã€Geoã€Bitmapsï¼ˆPhase Cï¼‰

### äºŒã€æŒä¹…åŒ–ä¸æ•°æ®å®‰å…¨ âœ… åŸºç¡€å·²å®Œæˆ

- âœ… **æŒä¹…åŒ–æ ¼å¼**ï¼šAOFï¼ˆeverysec è¯­ä¹‰ï¼‰ä¸ RDB å¯¼å‡º/å¯¼å…¥å·²å®ç°
  - æ”¯æŒå¯åŠ¨åŠ è½½ã€SAVE/BGSAVE/LASTSAVE å‘½ä»¤
  - è‡ªåŠ¨å®šæ—¶ä¿å­˜ä¸ AOF å¼‚æ­¥å†™å…¥
- âœ… **å´©æºƒæ¢å¤**ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ RDB/AOF æ•°æ®
- ğŸ”„ **å¾…å®Œå–„**ï¼šæŸåæ–‡ä»¶æ ¡éªŒä¸å‹å¥½é™çº§
- ğŸ”„ **å¤åˆ¶ï¼ˆç¤¾åŒºç‰ˆä¸Šé™ï¼‰**ï¼šåŸºç¡€ä¸»ä»å¤åˆ¶ï¼ˆå…¨é‡ + å¢é‡å‘½ä»¤æµï¼‰ä¸åªè¯»ä»åº“ï¼ˆPhase B/Cï¼‰

### ä¸‰ã€å†…å­˜ç®¡ç†ä¸æ·˜æ±°
- å¯¹é½ Redis çš„ `maxmemory` ç­–ç•¥ï¼šallkeys-lruã€volatile-lruã€allkeys-randomã€volatile-ttl ç­‰ï¼›æ”¯æŒ `maxmemory-policy` é…ç½®ã€‚
- å¤§ key/å¤§é›†åˆä¿æŠ¤ï¼šå†™å…¥ä¸è¯»å–çš„å°ºå¯¸é™åˆ¶ã€æ¸è¿›å¼é‡Šæ”¾ç­–ç•¥ï¼Œé¿å…å• key æ‹–å®å®ä¾‹ã€‚
- ç²¾å‡†è¿‡æœŸä¸é‡‡æ ·ï¼šä¼˜åŒ–é‡‡æ ·ç­–ç•¥ä¸æ—¶é—´è½®/åˆ†å±‚å®šæ—¶ç»“æ„ï¼Œå‡å°‘è¿‡æœŸæŠ–åŠ¨ã€‚

### å››ã€å®‰å…¨ä¸ç§Ÿæˆ·éš”ç¦»
- è®¤è¯ä¸ ACLï¼šåœ¨ç°æœ‰ AUTH åŸºç¡€ä¸Šå¢åŠ  ACL å­é›†ï¼ˆç”¨æˆ·/è§„åˆ™/é¢‘é“é™åˆ¶ï¼‰ï¼Œä¿æŒä¸å®¢æˆ·ç«¯äº¤äº’ä¸€è‡´ã€‚
- å¤š DB ä¸éš”ç¦»ï¼šå®Œå–„ DB é…ç½®ä¸éš”ç¦»ç­–ç•¥ï¼Œä¸ºæœªæ¥ç§Ÿæˆ·/ACL é“ºè·¯ã€‚
- ä¼ è¾“å®‰å…¨ï¼šé¢„ç ” TLS æ¥å…¥æ¨¡å¼ï¼ˆstunnel/å†…å»º TLSï¼‰ã€‚

### äº”ã€å¯è§‚æµ‹æ€§ä¸è¿ç»´
- æŒ‡æ ‡ä¸æ—¥å¿—ï¼šINFO æ‰©å±•ï¼ˆå†…å­˜ã€è¿‡æœŸã€å¤åˆ¶ã€Pub/Sub è®¡æ•°ç­‰ï¼‰ã€Prometheus æŒ‡æ ‡å®Œå–„ï¼ˆå« pubsub ç¼“å†²/æŠ•é€’/ä¸¢å¼ƒã€å­˜å‚¨æŒ‡æ ‡ï¼‰ã€ç»Ÿä¸€ç»“æ„åŒ–æ—¥å¿—ã€‚
- ç®¡ç†å‘½ä»¤ï¼šCONFIG GET/SET å­é›†ã€SLOWLOG åŸºç¡€æ”¯æŒã€CLIENT LIST/PAUSE/UNBLOCK å­é›†ï¼Œä¾¿äºè¿ç»´è„šæœ¬ç›´æ¥å¤ç”¨ã€‚
- å·¥å…·é“¾ï¼šæä¾› docker é•œåƒä¸ systemd ç¤ºä¾‹é…ç½®ï¼Œä¾¿äºéƒ¨ç½²ã€‚

### å…­ã€æ€§èƒ½ä¸å…¼å®¹æ€§éªŒè¯
- åŸºå‡†æµ‹è¯•ï¼šredis-benchmark/è‡ªç ” bench çš„å¯¹é½ï¼Œè¦†ç›– pipelineã€å¤šè¿æ¥ã€æ··åˆè¯»å†™ä¸å¤§ key åœºæ™¯ï¼Œè¾“å‡ºå¯¹æ¯”æŠ¥å‘Šã€‚
- å…¼å®¹æ€§å›å½’ï¼šç”¨ redis-cliã€go-redisã€jedis/lettuceã€node-redis ç­‰ä¸»æµå®¢æˆ·ç«¯è·‘å›å½’ç”¨ä¾‹ï¼Œè¦†ç›–äº‹åŠ¡ã€è®¢é˜…ã€pipelineã€è¶…æ—¶ç­‰è¡Œä¸ºã€‚
- èµ„æºå›å½’ï¼šåœ¨å†…å­˜/CPU é™åˆ¶ä¸‹çš„ç¨³å®šæ€§ä¸é™çº§ç­–ç•¥éªŒè¯ã€‚

### ä¸ƒã€ä¼ä¸šç‰ˆä¿ç•™é¡¹ï¼ˆä¸åœ¨ç¤¾åŒºç‰ˆèŒƒå›´ï¼‰
- Sentinel/Cluster è‡ªåŠ¨æ•…éšœè½¬ç§»ã€å¤šèŠ‚ç‚¹ä¸€è‡´æ€§ã€è·¨æœºæˆ¿å¤åˆ¶/å¤‡ä»½ã€‚
- é«˜çº§å®‰å…¨ï¼ˆç»†ç²’åº¦ ACLã€å®¡è®¡æ—¥å¿—ï¼‰ã€å¤šç§Ÿæˆ·éš”ç¦»å¼ºåŒ–ã€‚
- å•†ä¸šæ”¯æŒä¸è¿ç»´å¥—ä»¶ã€‚

> é˜¶æ®µå»ºè®®ï¼š
> - âœ… **Phase Aï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**ï¼šå·²å®Œæˆ
>   - 5 ç§æ•°æ®ç»“æ„ï¼ˆString/List/Set/Hash/Sorted Setï¼‰
>   - äº‹åŠ¡ï¼ˆMULTI/EXEC/WATCHï¼‰ä¸ Lua è„šæœ¬ï¼ˆredis.call/pcallï¼‰
>   - æŒä¹…åŒ–ï¼ˆAOF + RDBï¼‰
>   - Pub/Sub ä¸æ‰«æå‘½ä»¤
>   - åŸºç¡€è¿ç»´å‘½ä»¤
> - âœ… **Phase Bï¼ˆå‘½ä»¤è¡¥å…¨ä¸ HyperLogLogï¼‰**ï¼šå·²å®Œæˆï¼ˆ2025-12ï¼‰
>   - HyperLogLogï¼šPFADD/PFCOUNT/PFMERGE
>   - å‘½ä»¤è¡¥å…¨ï¼šHash/List/Sorted Set/Generic/Expire å…± 25+ å‘½ä»¤
>   - æ€§èƒ½ä¼˜åŒ–ä¸å†…å­˜ç®¡ç†å¢å¼º
> - ğŸ”„ **Phase Cï¼ˆæ•°æ®ç»“æ„æ‰©å±•ä¸ä¼ä¸šç‰ˆæ¢ç´¢ï¼‰**ï¼šè§„åˆ’ä¸­
>   - Streamsã€Geoã€Bitmaps
>   - ä¸»ä»å¤åˆ¶åŸºç¡€
>   - Sentinel/Cluster/å¤šå‰¯æœ¬ HA
>   - å®¡è®¡/æ›´ä¸°å¯Œ ACLã€è·¨æœºæˆ¿å¤åˆ¶ç­‰æ”¶è´¹ç‰¹æ€§

---

## æœ¬åœ°åŸºçº¿æ€§èƒ½ï¼ˆå•è¿æ¥ï¼Œå¯¹æ¯” Redisï¼‰

> ç¯å¢ƒè¯´æ˜ï¼š
> - æœºå™¨ï¼šæœ¬åœ°å¼€å‘æœºï¼ˆCPU/å†…å­˜æœªç‰¹åˆ«é™åˆ¶ï¼Œå•å®ä¾‹ï¼Œloopback ç½‘ç»œï¼‰ã€‚
> - å‹æµ‹æ–¹å¼ï¼š`cargo run --release --bin resp_set_get_bench`ï¼Œå•è¿æ¥ã€åŒæ­¥å¾€è¿”ã€‚
> - è¿­ä»£æ¬¡æ•°ï¼šå„ç»„ `--iterations=5000`ï¼Œæ‰€æœ‰ group ä¾æ¬¡ä¸²è¡Œæ‰§è¡Œã€‚
> - Redustï¼šç›‘å¬ `127.0.0.1:6380`ï¼Œæ—  AUTHã€‚
> - Redisï¼šç›‘å¬ `127.0.0.1:6379`ï¼Œ`AUTH lab`ã€‚

### 1. Redust @ 127.0.0.1:6380ï¼ˆæ—  AUTHï¼‰

å‘½ä»¤ï¼š

```bash
cargo run --release --bin resp_set_get_bench -- \
  --addr=127.0.0.1:6380 \
  --iterations=5000
```

ç»“æœæ¦‚è§ˆï¼ˆå– `ops/sec`ï¼Œè¶Šå¤§è¶Šå¥½ï¼‰ï¼š

| group            | è¯­ä¹‰æ¦‚è¿°                     | total ops | ops/sec |
|------------------|------------------------------|----------:|--------:|
| `ping`           | çº¯ PING å¾€è¿”                 |     5,000 | 20,896.78 |
| `mset_mget`      | å›ºå®š 10 key çš„ MSET + MGET   |    10,000 |  5,816.35 |
| `hash_ops`       | åŒä¸€ Hash ä¸Š HSET+HGET       |    10,000 | 16,651.40 |
| `set_get`        | å• key SET+GET               |    10,000 | 16,028.64 |
| `incr_decr`      | å• key INCR+DECR             |    10,000 | 19,232.68 |
| `exists_del`     | SET+EXISTS+DEL ç»„åˆ          |    15,000 | 18,043.76 |
| `list_ops`       | LPUSH/RPUSH/LRANGE ç»„åˆ      |    15,000 | 16,839.69 |
| `list_pops`      | LPOP/RPOP å¾ªç¯               |    10,000 | 15,145.64 |
| `set_union`      | ä¸¤ä¸ªé›†åˆä¸Šçš„ SADD+SUNION     |    15,000 |  1,215.17 |
| `set_intersection` | ä¸‰é›†åˆ SADD+SINTER         |    20,000 |  7,298.96 |
| `set_difference` | ä¸¤é›†åˆ SADD+SDIFF            |    10,000 |  1,711.47 |

### 2. Redis @ 127.0.0.1:6379ï¼ˆAUTH labï¼‰

å‘½ä»¤ï¼š

```bash
cargo run --release --bin resp_set_get_bench -- \
  --addr=127.0.0.1:6379 \
  --iterations=5000 \
  --auth=lab
```

ç»“æœæ¦‚è§ˆï¼š

| group              | è¯­ä¹‰æ¦‚è¿°                     | total ops | ops/sec |
|--------------------|------------------------------|----------:|--------:|
| `ping`             | çº¯ PING å¾€è¿”                 |     5,000 | 11,926.82 |
| `mset_mget`        | å›ºå®š 10 key çš„ MSET + MGET   |    10,000 | 10,582.72 |
| `hash_ops`         | åŒä¸€ Hash ä¸Š HSET+HGET       |    10,000 | 11,245.02 |
| `set_get`          | å• key SET+GET               |    10,000 | 11,213.62 |
| `incr_decr`        | å• key INCR+DECR             |    10,000 | 11,420.17 |
| `exists_del`       | SET+EXISTS+DEL ç»„åˆ          |    15,000 | 11,461.14 |
| `list_ops`         | LPUSH/RPUSH/LRANGE ç»„åˆ      |    15,000 | 11,000.05 |
| `list_pops`        | LPOP/RPOP å¾ªç¯               |    10,000 | 11,123.26 |
| `set_union`        | ä¸¤ä¸ªé›†åˆä¸Šçš„ SADD+SUNION     |    15,000 |    719.25 |
| `set_intersection` | ä¸‰é›†åˆ SADD+SINTER           |    20,000 |  8,649.56 |
| `set_difference`   | ä¸¤é›†åˆ SADD+SDIFF            |    10,000 |    641.30 |

### 3. ç²—ç•¥è§‚å¯Ÿä¸åç»­æ–¹å‘

- **æ³¨æ„ï¼š** ä»¥ä¸Šä¸ºå•æœºã€å¼€å‘ç¯å¢ƒä¸‹çš„å•è¿æ¥å¾€è¿”ååï¼Œå°šæœªè€ƒè™‘ pipelineã€å¤šè¿æ¥ã€é«˜å¹¶å‘ã€å†…å­˜å ç”¨ç­‰å› ç´ ï¼Œä»…ä½œä¸ºæ—©æœŸå¯¹æ¯”å‚è€ƒã€‚
- Redust åœ¨éƒ¨åˆ†è½»é‡å‘½ä»¤ï¼ˆ`PING`ã€`INCR/DECR` ç­‰ï¼‰ä¸Šçš„å•è¿æ¥ QPS å·²å¤„äºå¯ç”¨æ°´å¹³ï¼Œä½†ä¸ Redis ç›¸æ¯”ï¼Œä¸åŒå‘½ä»¤æ—çš„ç›¸å¯¹å…³ç³»å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œåç»­éœ€è¦ç»“åˆ flamegraph/Profiling åšæ›´ç»†ç²’åº¦åˆ†æã€‚
- é›†åˆç›¸å…³å‘½ä»¤ï¼ˆå°¤å…¶æ˜¯ `SUNION` / `SDIFF`ï¼‰åœ¨ Redust ä¸ Redis ä¸Šéƒ½è¡¨ç°ä¸ºæ˜æ˜¾ä½äºå…¶ä»–å‘½ä»¤ï¼Œç¬¦åˆå…¶ O(N) ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ `future.md` ä¸­ç™»è®°åç»­ä¼˜åŒ–æ–¹å‘ï¼ˆä¾‹å¦‚ï¼šå‡å°‘åˆ†é…ã€ä¼˜åŒ–éå†ç­–ç•¥ï¼‰ã€‚
